<html>
	<head>
		<title>Acolyte Fight!</title>
		<link rel="apple-touch-icon" sizes="180x180" href="static/icons/favicon-180.png">
		<link rel="icon" type="image/png" sizes="32x32" href="static/icons/favicon-32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="static/icons/favicon-16.png">
		<meta name="theme-color" content="#00ccff">
		<link rel="stylesheet" href="static/main.css"></link>
		<link rel="stylesheet" href="static/fontawesome-pro/css/all.css">
		<link rel="stylesheet" href="static/rpg-awesome/css/rpg-awesome.min.css">
		<link rel="manifest" href="manifest.webmanifest" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
		<style>
			html, body {
				overflow: hidden;
				padding: 0;
				margin: 0;
			}

			canvas {
				background: black;
			}

			canvas.center {
				margin: auto;
				padding: 0;
				display: block;
			}
		</style>

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122657176-1"></script>
		<script>
			window.gaTrackingId = 'UA-122657176-1';
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', window.gaTrackingId);
		</script>
	</head>
	<body class="game">
		<script src="https://connect.facebook.net/en_US/fbinstant.6.2.js"></script>
		<script>
			window.acolyteFacebook = true;
			if (window.location.hostname === "localhost") {
				window.baseUrl = "https://dev.acolytefight.io:7770";
			} else {
				window.baseUrl = "https://acolytefight.io";
			}
		</script>

        <script>
			function authenticate() {
                return FBInstant.player.getSignedPlayerInfoAsync().then(function (result) {
                    var signature = result.getSignature();
                    return fetch(window.baseUrl + "/api/facebook", {
						method: "POST",
						headers: {
							'Content-Type': 'application/json',
						},
                        body: JSON.stringify({ signature }),
					}).then(function(res) { 
						if (res.status === 200) {
							return res.json().then(function(json) {
								console.log("Facebook login succeeded");
								window.acolyteAuthToken = json.authToken;
							});
						} else {
							return res.text().then(function(text) {
								console.error("Facebook login failed: ", res.status, text);
							});
						}
					})
                })
			}

			function loadScript() {
				return new Promise(function(resolve) {
					var scriptTag = document.createElement('script');
					scriptTag.setAttribute('src','dist/client.js');
					scriptTag.addEventListener('load', resolve);

					document.head.appendChild(scriptTag);
				});
			}

            FBInstant.initializeAsync().then(function() {        
				FBInstant.setLoadingProgress(0);
				return authenticate();
            }).then(function() {
				FBInstant.setLoadingProgress(10);
				return loadScript();
			}).then(function() {
                FBInstant.setLoadingProgress(100);
                return FBInstant.startGameAsync();
            }).then(function() {
                // Retrieving context and player information can only be done
                // once startGameAsync() resolves
                var contextId = FBInstant.context.getID();
                var contextType = FBInstant.context.getType();
				var username = FBInstant.player.getName();
				var avatarUrl = FBInstant.player.getPhoto();

				window.acolyteDefaultName = username;

				console.log("Starting Acolyte Fight!...", contextId, contextType, username, avatarUrl);
				window.acolyteInitialize();
            }).catch(error => console.error(error));
        </script>

		<div id="root"></div>
	</body>
</html>
