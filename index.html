<html>
	<head>
		<title>Acolyte Fight! - multiplayer spell arena</title>
		<meta name="description" content="Multiplayer spell arena. Choose from the large selection of spells and make your own strategy. Fight your way to the top!" />
		<link rel="apple-touch-icon" sizes="180x180" href="static/icons/favicon-180.png">
		<link rel="icon" type="image/png" sizes="32x32" href="static/icons/favicon-32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="static/icons/favicon-16.png">
		<meta name="theme-color" content="#00ccff">
		<link rel="manifest" href="manifest.webmanifest" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
		<link rel="stylesheet" href="static/fontawesome-pro/css/all.css" />
		<link rel="stylesheet" href="static/rpg-awesome/css/rpg-awesome.min.css" />
		<style>
			html, body {
				overflow: hidden;
				padding: 0;
				margin: 0;
			}

			canvas {
				background: black;
			}

			canvas.center {
				margin: auto;
				padding: 0;
				display: block;
			}

			@font-face {
				font-family: 'ChicagoFLF';
				src: url('static/ChicagoFLF.ttf') format('truetype');
				font-weight: normal;
				font-style: normal;
			}
		</style>

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122657176-1"></script>
		<script>
			window.gaTrackingId = 'UA-122657176-1';
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', window.gaTrackingId);
			gtag('config', 'AW-778742698');
		</script>

		<script>
			function loadScript(src) {
				return new Promise((resolve, reject) => {
					const scriptTag = document.createElement("script");
					scriptTag.src = src;
					scriptTag.addEventListener('load', (ev) => {
						resolve();
					});
					scriptTag.addEventListener('error', () => {
						console.error("Error loading script", src);
						reject();
					});
					document.head.appendChild(scriptTag);
				});
			}

			if (window.location.host === "localhost:8080") {
				window.baseUrl = "https://dev.acolytefight.io:7770";
			} else if (/\.fbsbx\.com/.test(window.location.origin)
				|| /\.facebook\.com/.test(window.location.origin)) {

				window.baseUrl = "https://acolytefight.io";
			} else {
				// URL is correct already
			}
			window.acolyteStartup = loadScript((window.baseUrl || "") + "/dist/client.js");

			if (window.location.pathname === "/poki") {
				console.log("Attaching poki...");
				window.acolyteStartup = window.acolyteStartup
					.then(function() { return loadScript("//game-cdn.poki.com/scripts/v2/poki-sdk.js"); })
					.then(function() { return PokiSDK.init(); })
					.then(function() { PokiSDK.gameLoadingStart(); })
					.then(function() { console.log("Poki attached.") })
			} else if (window.location.pathname === "/kongregate") {
				console.log("Attaching kongregate...");
				window.acolyteStartup = window.acolyteStartup
					.then(function() { return loadScript("https://cdn1.kongregate.com/javascripts/kongregate_api.js"); })
					.then(function() { return new Promise(function(resolve) {
						kongregateAPI.loadAPI(resolve);
					})})
					.then(function() { window.kongregate = kongregateAPI.getAPI(); })
					.then(function() { console.log("Kongregate attached.") })
			} else if (
				window.location.pathname === "/fb"
				|| window.location.host === "localhost:8080"
				|| /\.fbsbx\.com/.test(window.location.origin)
				|| /\.facebook\.com/.test(window.location.origin)) {

				console.log("Attaching facebook...");
				window.acolyteStartup = window.acolyteStartup
					.then(function() { return loadScript("https://connect.facebook.net/en_US/fbinstant.6.2.js"); })
					.then(function() { return FBInstant.initializeAsync(); })
					.then(function() { return FBInstant.setLoadingProgress(0); })
					.then(function() { console.log("Facebook attached.") })
			}
		</script>
	</head>
	<body class="game">
		<div id="root"></div>
		<script>
			window.acolyteStartup.then(function() { window.acolyteInitialize(); });
		</script>
	</body>
</html>
